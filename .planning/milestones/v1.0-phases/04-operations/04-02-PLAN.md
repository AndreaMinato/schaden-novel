---
phase: 04-operations
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - nuxt.config.ts
  - .nuxtignore
autonomous: true
requirements:
  - OPS-03

must_haves:
  truths:
    - "All 13,318 chapter files exist under content/ across 10 novel directories"
    - "Legacy src/ and dist/ directories no longer exist"
    - "All 10 novels have prerender routes (not just lrg and mga)"
    - "All 10 novel RSS routes are prerendered"
    - "content/ is in Vite watch ignore list to prevent EMFILE"
  artifacts:
    - path: "nuxt.config.ts"
      provides: "Full-site prerender config for all 10 novels"
      contains: "for (const novel of novels)"
    - path: ".nuxtignore"
      provides: "Updated ignore patterns without legacy dirs"
  key_links:
    - from: "nuxt.config.ts prerender:routes"
      to: "content/{novel}/"
      via: "getChapterSlugs reads filenames"
      pattern: "getChapterSlugs"
    - from: "nuxt.config.ts vite.server.watch.ignored"
      to: "content/"
      via: "glob pattern prevents EMFILE"
      pattern: "content"
---

<objective>
Migrate all 13,318 chapters from legacy src/content/novels/ to Nuxt Content content/ directory, delete legacy directories, and update configuration for full-site operation.

Purpose: OPS-03 content migration. Move from partial (2 novels) to full (10 novels) site. Clean up legacy Astro artifacts.
Output: content/ with 13K chapters, updated nuxt.config.ts and .nuxtignore, no src/ or dist/
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-operations/04-RESEARCH.md
@nuxt.config.ts
@.nuxtignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate content and delete legacy directories</name>
  <files>content/ (all novels), src/ (deleted), dist/ (deleted)</files>
  <action>
**Step 1: rsync content migration**
```bash
rsync --archive --delete --verbose src/content/novels/ content/
```
This copies all 10 novel directories into content/, overwrites the existing mga and lrg with src/ versions for consistency (per user decision), and --delete removes any files in content/ not present in src/.

**Step 2: Verify file counts per novel**
Run a per-novel file count comparison:
```bash
for novel in atg cd htk issth lrg mga mw overgeared rtw tmw; do
  src_count=$(find src/content/novels/$novel -name '*.md' | wc -l)
  dst_count=$(find content/$novel -name '*.md' | wc -l)
  echo "$novel: src=$src_count content=$dst_count"
done
```
All counts must match. Total should be ~13,318.

**Step 3: Delete legacy directories**
```bash
rm -rf src/ dist/
```

**Step 4: Verify deletion**
```bash
ls -d src/ dist/ 2>&1  # Should show "No such file or directory" for both
```
  </action>
  <verify>
`find content -name '*.md' | wc -l` returns ~13,318.
`ls -d src/ 2>&1` shows "No such file or directory".
`ls -d dist/ 2>&1` shows "No such file or directory".
Each novel directory exists under content/ with matching file count from src/.
  </verify>
  <done>All 13,318 chapters are in content/ under their respective novel directories, and legacy src/ and dist/ directories are deleted.</done>
</task>

<task type="auto">
  <name>Task 2: Update nuxt.config.ts and .nuxtignore for full-site operation</name>
  <files>nuxt.config.ts, .nuxtignore</files>
  <action>
**nuxt.config.ts changes:**

1. **Expand prerender:routes to all 10 novels.** Replace the current hook body (which only does lrg fully and mga first 500) with a loop over all novels:
```typescript
'prerender:routes': function (routes: Set<string>) {
  const novels = ['atg', 'cd', 'htk', 'issth', 'lrg', 'mga', 'mw', 'overgeared', 'rtw', 'tmw']
  for (const novel of novels) {
    routes.add(`/novels/${novel}`)
    for (const slug of getChapterSlugs(novel)) {
      routes.add(`/novels/${novel}/${slug}`)
    }
  }
}
```
This removes the mga 500-chapter limit and adds all 10 novel index + chapter routes.

2. **Add all 10 RSS prerender routes.** Replace the 2 RSS routes:
```typescript
routes: [
  '/', '/200.html', '/404.html',
  '/rss.xml',
  '/novels/atg/rss.xml', '/novels/cd/rss.xml', '/novels/htk/rss.xml',
  '/novels/issth/rss.xml', '/novels/lrg/rss.xml', '/novels/mga/rss.xml',
  '/novels/mw/rss.xml', '/novels/overgeared/rss.xml', '/novels/rtw/rss.xml',
  '/novels/tmw/rss.xml',
],
```

3. **Update ignore array.** Remove `'src/**', 'dist/**'` since those dirs no longer exist:
```typescript
ignore: [],
```

4. **Update vite.server.watch.ignored.** Remove `'**/src/**', '**/dist/**'` (gone). Add `'**/content/**'` (13K files would cause EMFILE):
```typescript
ignored: [
  '**/content/**',
  '**/tmp/**', '**/build-cache/**', '**/.planning/**',
  '**/.astro/**', '**/.frontmatter/**',
],
```

5. **Update content.watch comment** to reference content/ not src/:
```typescript
watch: {
  enabled: false,  // Disable content watching — 13K chapter files cause EMFILE on dev server
},
```

**.nuxtignore changes:**
Remove `src/**` and `dist/**` lines (dirs no longer exist). Add `content/**` if it helps (though content.watch.enabled: false should suffice — .nuxtignore primarily affects Nuxt module scanning, not content watching). Keep other entries:
```
build-cache/**
tmp/**
.planning/**
.astro/**
.frontmatter/**
```
  </action>
  <verify>
`grep 'src/' nuxt.config.ts` returns no matches (legacy refs removed).
`grep 'dist/' nuxt.config.ts` returns no matches.
`grep 'content/\*\*' nuxt.config.ts` returns match in vite watch ignored.
`grep -c 'rss.xml' nuxt.config.ts` returns 11 (1 global + 10 per-novel).
`grep 'for (const novel of novels)' nuxt.config.ts` returns match (all-novel prerender loop).
`grep 'src/' .nuxtignore` returns no matches.
  </verify>
  <done>nuxt.config.ts prerenders all 10 novels' chapters + RSS feeds, ignores content/ in Vite watcher, and has no references to deleted legacy directories. .nuxtignore cleaned of legacy entries.</done>
</task>

</tasks>

<verification>
1. `find content -name '*.md' | wc -l` ~ 13,318
2. `ls content/` shows all 10 novel directories: atg cd htk issth lrg mga mw overgeared rtw tmw
3. `ls src/ dist/ 2>&1` both show "No such file or directory"
4. `grep -c 'rss.xml' nuxt.config.ts` = 11
5. `grep 'for (const novel of novels)' nuxt.config.ts` matches (all-novel prerender)
6. `grep 'content' nuxt.config.ts` shows content/** in vite watch ignore
7. No references to src/ or dist/ in nuxt.config.ts or .nuxtignore
</verification>

<success_criteria>
- All 13,318 chapters migrated to content/ with matching per-novel file counts
- Legacy src/ and dist/ deleted
- All 10 novels prerendered (not just lrg + mga)
- All 10 novel RSS feeds prerendered
- Vite watcher ignores content/ to prevent EMFILE
- No dead config references to deleted directories
</success_criteria>

<output>
After completion, create `.planning/phases/04-operations/04-02-SUMMARY.md`
</output>
