---
phase: 03-full-site-parity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/composables/useNovelMeta.ts
  - app/composables/useReadingProgress.ts
  - app/components/ResumeDropdown.vue
  - app/pages/index.vue
  - app/pages/novels/index.vue
  - app/layouts/default.vue
autonomous: true
requirements: [CATL-01, CATL-02, PROG-02]

must_haves:
  truths:
    - "Home page displays latest 3 chapters per novel, sections ordered by most recently updated"
    - "Catalog page at /novels lists all novels with chapter counts, sorted alphabetically"
    - "Header dropdown shows last-read chapter per novel from localStorage"
    - "Home page has a resume reading section showing reading progress per novel"
    - "Empty state shows 'Start reading to track progress' in both dropdown and home section"
  artifacts:
    - path: "app/composables/useNovelMeta.ts"
      provides: "Novel name map and slug list"
      contains: "NOVEL_NAMES"
    - path: "app/composables/useReadingProgress.ts"
      provides: "Extended reading progress with getAll()"
      contains: "getAll"
    - path: "app/components/ResumeDropdown.vue"
      provides: "Resume reading dropdown for header"
      contains: "UDropdownMenu"
    - path: "app/pages/index.vue"
      provides: "Home page with novel sections and resume reading"
      contains: "queryCollection"
    - path: "app/pages/novels/index.vue"
      provides: "Catalog page with novel list and chapter counts"
      contains: "count"
    - path: "app/layouts/default.vue"
      provides: "Layout with nav links and resume dropdown"
      contains: "ResumeDropdown"
  key_links:
    - from: "app/pages/index.vue"
      to: "queryCollection"
      via: "useAsyncData wrapping Promise.all over 10 collections"
      pattern: "Promise\\.all.*queryCollection"
    - from: "app/pages/novels/index.vue"
      to: "queryCollection"
      via: "useAsyncData wrapping .count() for each collection"
      pattern: "queryCollection.*count"
    - from: "app/components/ResumeDropdown.vue"
      to: "localStorage"
      via: "useReadingProgress().getAll()"
      pattern: "getAll"
    - from: "app/layouts/default.vue"
      to: "app/components/ResumeDropdown.vue"
      via: "Component import in layout"
      pattern: "ResumeDropdown"
---

<objective>
Build the home page, catalog page, and resume reading experience — the three user-facing features that complete the site's browsing and navigation layer.

Purpose: Users can browse novels, see latest chapters, navigate to the catalog, and resume reading from where they left off — matching the Astro site's browsing UX.
Output: Rewritten home page, new catalog page, resume reading dropdown in header, updated layout with navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-full-site-parity/03-CONTEXT.md
@.planning/phases/03-full-site-parity/03-RESEARCH.md
@.planning/phases/02-chapter-reader/02-02-SUMMARY.md

@app/composables/useReadingProgress.ts
@app/layouts/default.vue
@app/pages/index.vue
@content.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useNovelMeta composable, extend useReadingProgress, and build ResumeDropdown component</name>
  <files>
    app/composables/useNovelMeta.ts
    app/composables/useReadingProgress.ts
    app/components/ResumeDropdown.vue
  </files>
  <action>
    **1. Create `app/composables/useNovelMeta.ts`:**
    - Export a `NOVEL_NAMES` record mapping all 10 slugs to display names:
      mga='Martial God Asura', atg='Against the Gods', overgeared='Overgeared', tmw='True Martial World', htk='Hail the King', issth='I Shall Seal the Heavens', cd='Coiling Dragon', lrg='LRG', mw='Martial World', rtw='Release That Witch'
    - Export `NOVEL_SLUGS` as `Object.keys(NOVEL_NAMES)` typed array
    - Export `getNovelName(slug: string): string` helper that returns the display name or slug.toUpperCase() as fallback

    **2. Extend `app/composables/useReadingProgress.ts`:**
    - Add a `getAll(): Record<string, string>` method that returns the entire localStorage object
    - Guard with `import.meta.client` check, return `{}` on server/error
    - Keep existing `save()` and `get()` methods unchanged
    - Return `{ save, get, getAll }` from the composable

    **3. Create `app/components/ResumeDropdown.vue`:**
    - Uses `UDropdownMenu` from Nuxt UI
    - Trigger button: text "Continue Reading" with a book icon (i-lucide-book-open)
    - On mount (client-side only), read `useReadingProgress().getAll()` into a reactive ref
    - Build dropdown items from progress entries:
      - Each item: label = `${getNovelName(novel)} - Chapter ${extractChapterFromPath(path)}`, navigates via `to: path`
      - Extract chapter number from path: split by '/' and take last segment
    - Empty state: single disabled item with label "Start reading to track progress"
    - Style the trigger as a subtle ghost button that fits the header
  </action>
  <verify>
    - `ls app/composables/useNovelMeta.ts app/composables/useReadingProgress.ts app/components/ResumeDropdown.vue` — all three files exist
    - `grep -c 'NOVEL_NAMES' app/composables/useNovelMeta.ts` — confirms export exists
    - `grep -c 'getAll' app/composables/useReadingProgress.ts` — confirms new method added
    - `grep -c 'UDropdownMenu' app/components/ResumeDropdown.vue` — confirms Nuxt UI dropdown used
  </verify>
  <done>
    useNovelMeta exports novel name map for all 10 novels. useReadingProgress has getAll() returning full localStorage object. ResumeDropdown renders a UDropdownMenu with progress entries or empty state message.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite home page, create catalog page, and update layout with navigation and resume dropdown</name>
  <files>
    app/pages/index.vue
    app/pages/novels/index.vue
    app/layouts/default.vue
  </files>
  <action>
    **1. Rewrite `app/pages/index.vue` (home page):**
    Per user decision: one section per novel, 3 recent chapters each, ordered by most recently updated.

    - Use `useAsyncData('home-novels', async () => { ... })` wrapping `Promise.all()` over `NOVEL_SLUGS`
    - For each novel: `queryCollection(slug as any).select('title', 'path', 'stem', 'pubDate').order('pubDate', 'DESC').limit(3).all()`
    - Return array of `{ slug, name, chapters }` objects
    - Filter out novels with 0 chapters (8 of 10 are currently empty — handle gracefully)
    - Sort sections by most recently updated (first chapter's pubDate, descending)
    - Template structure:
      - `<h1>` site title
      - **Resume Reading section** (client-only): use `useReadingProgress().getAll()` in an `onMounted` to populate a reactive ref. Show a "Continue Reading" heading with a list of entries: `${getNovelName(novel)} - Chapter ${num}` as NuxtLinks. If no progress: "Start reading to track progress" message. Wrap in `<ClientOnly>`.
      - **Novel sections**: For each novel with chapters, render a heading (novel display name as NuxtLink to `/novels/${slug}`), then a list of chapter entries. Each entry: NuxtLink to `/novels${ch.path}` showing chapter title (title field already includes chapter number, e.g. "Capitolo 100 - Sterminio"). Add "View all chapters" link to `/novels/${slug}`.
    - Handle empty state: if no novels have content, show a message

    **2. Create `app/pages/novels/index.vue` (catalog page):**
    Per user decision: simple vertical list, novel name + chapter count, sorted alphabetically, links to /novels/{novel}.

    - Use `useAsyncData('catalog', async () => { ... })` wrapping `Promise.all()` over `NOVEL_SLUGS`
    - For each novel: `queryCollection(slug as any).count()` to get chapter count
    - Return array of `{ slug, name, count }` objects
    - Filter to novels with count > 0
    - Sort alphabetically by name (using `a.name.localeCompare(b.name)`)
    - Template: `<h1>` "Novels", then a list where each entry is a NuxtLink to `/novels/${slug}` showing `${name}` and `${count} chapters`
    - Style: clean vertical list, good spacing, readable typography (max-w-2xl mx-auto)

    **3. Update `app/layouts/default.vue`:**
    - Add navigation links in the header: "Home" (/) and "Novels" (/novels) next to the "Schaden" logo
    - Add `<ResumeDropdown />` component in the header, aligned to the right side
    - Wrap ResumeDropdown in `<ClientOnly>` since it reads from localStorage
    - Keep existing auto-hide behavior and styling
    - Ensure header layout: logo + nav links on left, resume dropdown on right, using flex with justify-between
  </action>
  <verify>
    - Run `npx nuxi typecheck` or at minimum `npx nuxi prepare` — no TypeScript errors
    - `grep -c 'Promise.all' app/pages/index.vue` — confirms multi-collection query pattern
    - `grep -c 'count' app/pages/novels/index.vue` — confirms chapter count queries
    - `grep -c 'ResumeDropdown' app/layouts/default.vue` — confirms dropdown added to layout
    - `grep -c '/novels' app/layouts/default.vue` — confirms nav link to catalog
  </verify>
  <done>
    Home page shows latest 3 chapters per novel grouped by section, sorted by most recently updated. Catalog at /novels lists all novels with chapter counts sorted alphabetically. Layout has Home/Novels nav links and ResumeDropdown in header. Empty collections are filtered out. Resume reading section on home page shows progress from localStorage with empty state handling.
  </done>
</task>

</tasks>

<verification>
1. Home page renders novel sections with chapters from mga and lrg (the two novels with content)
2. Novel sections on home page are ordered by most recently updated (mga likely first given 2335 chapters)
3. Each section links to the novel detail page and shows up to 3 recent chapters
4. Catalog at /novels shows mga and lrg with correct chapter counts (2335, 84)
5. Catalog entries are sorted alphabetically (LRG before Martial God Asura)
6. Header has Home + Novels nav links and a Continue Reading dropdown
7. Resume dropdown shows "Start reading to track progress" when no progress exists
8. Resume reading section on home page shows same empty state initially
9. Empty novels (8 of 10) are not displayed on home page or catalog
</verification>

<success_criteria>
- `nuxi prepare` completes without errors
- Home page at / shows novel sections with recent chapters
- Catalog page at /novels lists novels with chapter counts
- Layout header has navigation links and resume reading dropdown
- All empty collections handled gracefully (no errors, just hidden)
</success_criteria>

<output>
After completion, create `.planning/phases/03-full-site-parity/03-01-SUMMARY.md`
</output>
